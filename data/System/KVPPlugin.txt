---+!! !KVPPlugin
<!--
One line description, required for extensions repository catalog.
BuildContrib will fill in the SHORTDESCRIPTION with the value of
$SHORTDESCRIPTION from the .pm module, or you can redefine it here if you
prefer.
   * Set SHORTDESCRIPTION = %$SHORTDESCRIPTION%
-->
%SHORTDESCRIPTION%

%TOC%

---++ Verwendung
---+++ Aufbau des Workflows
Der Workflow wird in in einem Topic definiert. Dort muss es zwei Tabellen in dieser Reihenfolge geben:
   [[%TOPIC%#Der_State_Table][state&nbsp;table]]: Diese Tabelle beschreibt die Stati in denen sich ein Artikel befinden kann. Hat ein Artikel keinen Status wird implizit der erste Status der Tabelle angenommen.
   [[%TOPIC%#Der_Transitions_Table][transitions&nbsp;table]]: Diese Tabelle beschreibt die &Uuml;berg&auml;nge von einem Status in den n&auml;chsten.

---+++ Der State Table
Die Tabelle hat folgenden Aufbau:
<verbatim>
| *State* | *Allow Edit* | *Allow View* | *Allow Comment* | *Message* | *State Group* | *Whatever...* |
| Ohne Freigabe | Main.PeterMustermann, Main.MartildeMusterfrau | LesenGroup | nobody | Alle vor Scharfschaltung des Workflows bestehenden Artikel sind in diesem Status. | nicht Freigegeben | ... |
| Neu angelegt | Main.PeterMustermann | LesenGroup | LesenGroup | Neu ersteller Artikel. | nicht Freigegeben | ... |
| Freigegeben | nobody | LesenGroup | LesenGroup | Freigegebener Artikel. | Freigegeben | ... |
| Diskussion | LesenGroup | LesenGroup | LesenGroup | Artikel wird diskutiert | nicht Freigegeben | ... |
</verbatim>
   State: (eindeutiger) Name f&uuml;r den Status
   Allow&nbsp;Edit: Liste mit Usern/Gruppen welche den Artikel editieren d&uuml;rfen.
   Allow&nbsp;View: Liste mit Usern/Gruppen welche den Artikel sehen d&uuml;rfen ([[%TOPIC%#HinweisStates][Hinweis!]]).
   Allow&nbsp;Comment: Liste mit Usern/Gruppen welche Kommentare schreiben d&uuml;rfen. Ist diese Liste leer, werden keine Kommentare angezeigt.
   Message: Der hier hinterlege Text wird im &Uuml;bergansmenue angezeigt.
   State&nbsp;Group: Entscheidet ob ein Artikel freigegeben ist (TODO: Configure). Wird in das Formfield &uuml;bertragen, falls es vorhanden ist (TODO)
   Allow&nbsp;Change&nbsp;Mail: Liste mit Usern/Gruppen welche die Mailing-Liste bearbeiten d&uuml;rfen (andere d&uuml;rfen nur sich selber entfernen/hinzuf&uuml;gen).
   Whatever: Es k&ouml;nnen beliebige Spalten hinzugef&uuml;gt werden und dann mit GETROW{"spaltenname"} abgefragt werden.

<a name="HinweisStates">Hinweis:</a> Werden die Anzeigerechte im Workflow ver&auml;ndert werden die alten Artikel *NICHT* automatisch aktuallisiert; der Anzeigezugriff wird erst bei der n&auml;chsten Transition angepasst. Ist hier etwas eingetragen, so wird die Einstellung =ALLOWTOPICVIEW= ver&auml;ndert.
---+++ Der Transitions Table
Diese Tabelle muss unterhalb des State Table stehen, sie hat folgenden Aufbau:
<verbatim>
| *State* | *Action* | *Next State* | *Allowed* | *Attribute* |
| Ohne Freigabe | Neu erstellen | Neu angelegt | SchreibenGroup | NEW |
| Ohne Freigabe | Frei geben | Freigegeben | Mail.PeterMustermann | ALLOWDELETECOMMENTS |
| Freigegeben | Diskutieren | Diskussion | LesenGroup | FORK |
| Diskussion | Annehmen | Freigegeben | Main.PeterMustermann | SUGGESTDELETECOMMENTS, ACCEPT |
| Diskussion | Verwerfen | Ohne Freigabe | LesenGroup | DISCARD |
</verbatim>
   State: In diesem Status muss der Artikel sein, damit die Aktion durchgef&uuml;hrt werden kann
   Action: (eindeutiger) Name f&uuml;r die Aktion
   Next&nbsp;State: In diesen Status wird der Artikel durch die Aktion &uuml;berf&uuml;hrt.
   Allowed: Liste mit Usern/Gruppen, welche diese Aktion durchf&uuml;hren k&ouml;nnen
   Attribute: Liste mit [[%TOPIC%#Attribute][Attributen]] f&uuml;r diese Aktion.
---++++ Attribute
Jede Aktion kann mehrere Attribute haben.
| *Attribut* | *Beschreibung* | *Kommentar* |
| NEW | Diese Aktion wird durchgef&uuml;hrt wenn ein neuer Artikel angelegt wird. | Stehen mehrere Aktionen zur Verf&uuml;gung wird die erste gew&auml;hlt. Als Ausgangsstate muss der erste Status aus dem "State table" angegeben sein. Hat ein User keine Aktion mit NEW, dann kann er keine neuen Artikel anlegen. Diese Aktion ist im Workflowmenue nicht zu sehen. |
| FORK | Diese Aktion wird ausgef&uuml;hrt wenn ein Artikel ge"forkt" wird (eine Diskussion er&ouml;ffnet wird). | Stehen mehrere Aktionen zur Verf&uuml;gung wird die erste gew&auml;hlt. Hat ein User keine Aktion mit FORK, dann kann er keine Diskussion er&ouml;ffnen. Diese Aktion ist im Workflowmenue nicht zu sehen. |
| ACCEPT | Wenn diese Aktion durchgef&uuml;hrt wird, dann wird die Diskussion auf den "Normalen" Artikel (ohne Talk-Suffix) verschoben. | Der original Artikel wird ersetzt. |
| DISCARD | Wenn diese Aktion durchgef&uuml;hrt wird, dann wird der Artikel gel&ouml;scht (ins Trash Web verschoben). | Funktioniert auch mit "normalen" Artikeln ("nicht Diskussionen"), jedoch bleiben die Diskussionen bestehen. |
| DELETECOMMENTS | Durch diese Aktion werden alle Kommentare gel&ouml;scht. | |
| ALLOWDELETECOMMENTS | Bei dieser Aktion hat der Durchf&uuml;hrende die M&ouml;glichkeit alle Kommentare zu l&ouml;schen. | Vorauswahl: Kommentare nicht l&ouml;schen. |
| SUGGESTDELETECOMMENTS | Wie ALLOWDELETECOMMENTS, aber andere Vorauswahl. | Vorauswahl: Kommentare l&ouml;schen. |
| NOEXTRANOTIFY | Bei dieser Aktion werden keine Emails zur Statusbenachrichtigung versendet. | Unterbindet *nicht* WebNotify. |

---+++ Einschalten des Workflows in Topics
Der Workflow wird auf Topic/Web Ebene angeschaltet mit
<pre>
&nbsp;&nbsp;&nbsp;* Set WORKFLOW = WorkflowTopic
</pre>
Soll er in einem Topic deaktiviert werden, so geschieht dies mit
<pre>
&nbsp;&nbsp;&nbsp;* Set WORKFLOW =
</pre>

---++ Beispiel
In einem Wiki soll das KVPPlugin aktiviert werden. Es gelten folgende Anforderungen:
   * A1: Alle Vorhandenen Artikel sollen als "nicht Freigegeben" angezeigt werden.
   * A2: Diskussionen sollen als "nicht Freigegeben" angezeigt werden.
   * A3: Neue Artikel sollen gekennzeichnet und als "nicht Freigegeben" angezeigt werden.
   * A4: Nur die Gruppen Abteilungsleitung und Gesch&auml;ftsf&uuml;hrung d&uuml;rfen Artikel anlegen.
   * A4.5 Nur Abteilungsleitung, Prozesseigner und Gesch&auml;ftsf&uuml;hrung d&uuml;rfen neue Artikel bearbeiten.
   * A5: Nur Prozesseigner d&uuml;rfen Diskussionen zur Freigabe vorschlagen.
   * A6: Nur die Gesch&auml;ftf&uuml;hrung darf Artikel freigeben.
   * A7: Nur Abteilungsleiter und Prozesseigner d&uuml;rfen Artikel zur L&ouml;schung vorschlagen.
   * A8: Nur die Gesch&auml;ftsf&uuml;hrung darf freigegebene Artikel l&ouml;schen.
   * A9: Nur die Gesch&auml;ftsf&uuml;hrung darf freigegebene Artikel bearbeiten.
   * A10: Alle d&uuml;rfen Diskutieren.
   * A11: Nur der Prozesseigner, Abteilungsleiter  und die F&uuml;hrung d&uuml;rfen Diskussionen verwerfen.
   * A11: Nur im Diskussionsstand darf Kommentiert werden.
   * A12: Bei zur Freigabe Vorgeschlagenen Artikel darf nicht Kommentiert werden, aber Kommentare werden angzeigt.

State Table:
| *State* | *Allow Edit* | *Allow View* | *Allow Comment* | *Message* | *State Group* | *Anforderung* |
| Kein Freigabeprozess | Fuehrung, Abteilungsleitung | All | | Dieser Artikel unterliegt noch nicht dem Freigabeprozess. | nicht Freigegeben | A1 |
| Neu Erstellt | Fuehrung, Abteilungsleitung, percentQUERY{"Prozesseigner"}percent | All | | Dieser Artikel wurde neu erstellt. | nicht Freigegeben | A3, A4 |
| Freigegeben | Fuehrung | All | | Dieser Artikel wurde freigegeben. | Freigegeben | A9 |
| Diskussion | All | All | All | Dieser Artikel wird diskutiert. | nicht Freigegeben | A2, A10, A11 |
| Verworfen | nobody | Fuehrung | Dieser Artikel wurde verworfen. | |
| Vorgeschlagen | nobody | All | nobody | Dieser Artikel wurde zur Freigabe vorgeschlagen. | nicht Freigegeben | A12 |
| Zur Loeschung | Fuehrung | All | | Dieser Artikel wurde zur L&ouml;schung vorgeschlagen. | | A7 |

Transitions:
| *State* | *Action* | *Next State* | *Allowed* | *Attribute* | *Anforderung* |
| Kein Freigabeprozess | Neu erstellen | Neu Erstellt | Fuehrung, Abteilungsleitung | NEW | A3, A4 |
| Kein Freigabeprozess | Freigeben | Freigegeben | Fuehrung | | A6, Alten Artikel freigeben |
| Neu Erstellt | Freigeben | Freigegeben | Fuehrung | | A6, Neu erstellten Artikel freigeben |
| Freigegeben | Diskutieren | Diskussion | All | FORK | A10 |
| Diskussion | Zur Freigabe vorschlagen | Vorgeschlagen | percentQUERY{"Prozesseigner"}percent | | A5 |
| Diskussion | Verwerfen | percentQUERY{"Prozesseigner"}pecent, Fuehrung, Abteilungsleiter | DISCARD | A11 |
| Freigegeben | Zur Loeschung vorschlagen | Zur Loeschung | percentQUERY{"Prozesseigner"}percent, Abteilungsleiter | | A7 |
| Kein Freigabeprozess | Zur Loeschung vorschlagen | Zur Loeschung | percentQUERY{"Prozesseigner"}percent, Abteilungsleiter | | A7 |
| Vorgeschlagen | Freigeben | Freigegeben | Fuehrung | ACCEPT | A6 |
| Freigegeben | Loeschen | Verworfen | Fuehrung | DISCARD | A8, es geht weiterhin das Verschieben in Trasch |
| Zur Loeschung | Loeschen | Verworfen | Fuehrung | DISCARD | A8 |
| Zur Loeschung | nicht loeschen | Freigegeben | Fuehrung | | A8 |
---++ Installation Instructions

%$INSTALL_INSTRUCTIONS%

---++ Info

Many thanks to the following sponsors for supporting this work:
   * Acknowledge any sponsors here

|  Author(s): | |
|  Copyright: | &copy; |
|  License: | [[http://www.gnu.org/licenses/gpl.html][GPL (Gnu General Public License)]] |
|  Release: | %$RELEASE% |
|  Version: | %$VERSION% |
|  Change History: | <!-- versions below in reverse order -->&nbsp; |
|  Dependencies: | %$DEPENDENCIES% |
|  Home page: | handbuch.open-quality.com/bin/view/Extensions/KVPPlugin |
|  Support: | handbuch.open-quality.com/bin/view/Support/KVPPlugin |

<!-- Do _not_ attempt to edit this topic; it is auto-generated. -->
